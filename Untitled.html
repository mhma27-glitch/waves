<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.6">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
  </style>
</head>
<body>
<p class="p1">&lt;!doctype html&gt;</p>
<p class="p1">&lt;html lang="ar" dir="rtl"&gt;</p>
<p class="p1">&lt;head&gt;</p>
<p class="p1">&lt;meta charset="utf-8" /&gt;</p>
<p class="p1">&lt;meta name="viewport" content="width=device-width,initial-scale=1" /&gt;</p>
<p class="p1">&lt;title&gt;Ù…ÙˆÙ„Ù‘Ø¯ Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ù…ÙˆØ¬ÙŠØ© â€” ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ù…Ø§ÙˆØ³&lt;/title&gt;</p>
<p class="p1">&lt;style&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>:root{--bg:#0b0e14;--fg:#e6e6e6;--acc:#00d0ff;--mut:#9aa4ad}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>body{margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,Segoe UI,Arial}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>header{padding:14px 16px;border-bottom:1px solid #1d2330;display:flex;gap:12px;align-items:center;flex-wrap:wrap}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>header h1{font-size:16px;margin:0;color:#cde9ff}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>button,select,input[type=range]{accent-color:var(--acc)}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>button{background:#16202e;color:var(--fg);border:1px solid #243244;border-radius:8px;padding:8px 12px;cursor:pointer}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>button:active{transform:translateY(1px)}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.grid{display:grid;grid-template-columns:1fr 1fr;gap:14px;padding:14px}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.card{background:#0f1420;border:1px solid #1d2330;border-radius:12px;padding:12px}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.card h2{margin:0 0 8px 0;font-size:14px;color:#9bd3ff}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.row{display:flex;align-items:center;gap:8px;margin:6px 0}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.row label{min-width:110px;color:#c7d1dc;font-size:13px}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.row output{min-width:54px;text-align:end;color:#8fb3c9}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>canvas{width:100%;height:180px;background:#0a0e16;border-radius:10px;border:1px solid #1a2231}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>#pad{height:240px;cursor:crosshair;touch-action:none;background:linear-gradient(180deg,#0b1524,#0a0e16)}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.hint{color:var(--mut);font-size:12px;margin-top:6px;line-height:1.4}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.footer{padding:10px 14px;color:#7f91a4;border-top:1px solid #1d2330;font-size:12px}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>@media (max-width:920px){.grid{grid-template-columns:1fr}}</p>
<p class="p1">&lt;/style&gt;</p>
<p class="p1">&lt;/head&gt;</p>
<p class="p1">&lt;body&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;header&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;h1&gt;ğŸ›ï¸ Ù…ÙˆØ¬Ø§Øª + ÙÙ„ØªØ± + LFO + ADSR + Delay â€” ØªØ­ÙƒÙ… Ø­ÙŠ Ø¨Ø§Ù„Ù…Ø§ÙˆØ³&lt;/h1&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;button id="startBtn"&gt;ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;button id="stopAll"&gt;Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ÙƒÙ„&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;select id="preset"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;option value="init"&gt;Preset: INIT&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;option value="pluck"&gt;Pluck&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;option value="bass"&gt;Bass&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;option value="pad"&gt;Pad&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;option value="lead"&gt;Lead&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/select&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;span class="hint"&gt;Ø­Ø±Ù‘Ùƒ Ø§Ù„Ù…Ø§ÙˆØ³ Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø§Ø¯ Ù„ØªØºÙŠÙŠØ± &lt;b&gt;Pitch&lt;/b&gt; (Ø£ÙÙ‚ÙŠ) Ùˆ &lt;b&gt;Cutoff&lt;/b&gt; (Ø¹Ù…ÙˆØ¯ÙŠ). Ø¹Ø¬Ù„Ø© Ø§Ù„Ù…Ø§ÙˆØ³ = Detune. Ø§Ù†Ù‚Ø± ÙˆØ§Ø³Ø­Ø¨ Ù„Ù„ØªØ´ØºÙŠÙ„. Ù„Ù…Ø³ Ù…Ø¯Ø¹ÙˆÙ….&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;/header&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;div class="grid"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div class="card"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;h2&gt;ğŸšï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙˆØª&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="row"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;label&gt;Wave 1&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;select id="wave1"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;option&gt;sawtooth&lt;/option&gt;&lt;option&gt;square&lt;/option&gt;&lt;option&gt;triangle&lt;/option&gt;&lt;option&gt;sinusoid&lt;/option&gt;&lt;option selected&gt;square&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;/select&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;label&gt;Wave 2&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;select id="wave2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;option selected&gt;sawtooth&lt;/option&gt;&lt;option&gt;square&lt;/option&gt;&lt;option&gt;triangle&lt;/option&gt;&lt;option&gt;sinusoid&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;/select&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="row"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;label&gt;Mix&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;input id="mix" type="range" min="0" max="1" step="0.01" value="0.5"/&gt;&lt;output&gt;0.50&lt;/output&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="row"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;label&gt;Master&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;input id="master" type="range" min="0" max="1" step="0.001" value="0.3"/&gt;&lt;output&gt;0.30&lt;/output&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="row"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;label&gt;Detune (Â¢)&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;input id="detune" type="range" min="-1200" max="1200" step="1" value="0"/&gt;&lt;output&gt;0&lt;/output&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;h2&gt;ğŸª— ADSR&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="row"&gt;&lt;label&gt;Attack&lt;/label&gt;&lt;input id="a" type="range" min="0" max="2" step="0.01" value="0.01"/&gt;&lt;output&gt;0.01&lt;/output&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="row"&gt;&lt;label&gt;Decay&lt;/label&gt;&lt;input id="d" type="range" min="0" max="2" step="0.01" value="0.15"/&gt;&lt;output&gt;0.15&lt;/output&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="row"&gt;&lt;label&gt;Sustain&lt;/label&gt;&lt;input id="s" type="range" min="0" max="1" step="0.01" value="0.6"/&gt;&lt;output&gt;0.60&lt;/output&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="row"&gt;&lt;label&gt;Release&lt;/label&gt;&lt;input id="r" type="range" min="0" max="3" step="0.01" value="0.2"/&gt;&lt;output&gt;0.20&lt;/output&gt;&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;h2&gt;ğŸ§ª ÙÙ„ØªØ±&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="row"&gt;&lt;label&gt;Type&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;select id="fType"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;option selected&gt;lowpass&lt;/option&gt;&lt;option&gt;bandpass&lt;/option&gt;&lt;option&gt;highpass&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;/select&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="row"&gt;&lt;label&gt;Cutoff (Hz)&lt;/label&gt;&lt;input id="cut" type="range" min="50" max="12000" step="1" value="1500"/&gt;&lt;output&gt;1500&lt;/output&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="row"&gt;&lt;label&gt;Resonance (Q)&lt;/label&gt;&lt;input id="q" type="range" min="0.1" max="24" step="0.1" value="1.0"/&gt;&lt;output&gt;1.0&lt;/output&gt;&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;h2&gt;ğŸŒŠ LFO (ÙØ§ÙŠØ¨/ÙˆØ§ÙˆØ¨)&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="row"&gt;&lt;label&gt;Target&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;select id="lfoTarget"&gt;&lt;option value="freq"&gt;Frequency&lt;/option&gt;&lt;option value="cutoff" selected&gt;Cutoff&lt;/option&gt;&lt;option value="am"&gt;Volume&lt;/option&gt;&lt;/select&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="row"&gt;&lt;label&gt;Rate (Hz)&lt;/label&gt;&lt;input id="lfoRate" type="range" min="0.1" max="20" step="0.1" value="4"/&gt;&lt;output&gt;4.0&lt;/output&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="row"&gt;&lt;label&gt;Depth&lt;/label&gt;&lt;input id="lfoDepth" type="range" min="0" max="1" step="0.001" value="0.5"/&gt;&lt;output&gt;0.500&lt;/output&gt;&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;h2&gt;â±ï¸ Delay&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="row"&gt;&lt;label&gt;Time (s)&lt;/label&gt;&lt;input id="delayTime" type="range" min="0" max="1" step="0.001" value="0.18"/&gt;&lt;output&gt;0.180&lt;/output&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="row"&gt;&lt;label&gt;Feedback&lt;/label&gt;&lt;input id="feedback" type="range" min="0" max="0.95" step="0.01" value="0.35"/&gt;&lt;output&gt;0.35&lt;/output&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="row"&gt;&lt;label&gt;Wet&lt;/label&gt;&lt;input id="wet" type="range" min="0" max="1" step="0.01" value="0.25"/&gt;&lt;output&gt;0.25&lt;/output&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div class="card"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;h2&gt;ğŸ¯ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ù…Ø§ÙˆØ³/Ø§Ù„ØªØ§ØªØ´&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;canvas id="pad"&gt;&lt;/canvas&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="hint"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>X = ØªØ±Ø¯Ø¯ (Ù„ÙˆØºØ§Ø±ÙŠØªÙ…ÙŠ Ù…Ù† 60Hz Ø¥Ù„Ù‰ 4kHz) â€” Y = Cutoff&lt;br&gt;</p>
<p dir="rtl" class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>Ø¹Ø¬Ù„Ø© Ø§Ù„Ù…Ø§ÙˆØ³ = Detune â€¢ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… 1..5 = Presets â€¢ Space = Ù…ÙŠÙˆØª Ù„Ø­Ø¸ÙŠ</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;h2&gt;ğŸ“ˆ ÙÙŠØ¬ÙˆØ§Ù„Ø§ÙŠØ²Ø±&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;canvas id="scope"&gt;&lt;/canvas&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;div class="footer"&gt;Â© DIY Web Audio â€” Ø§Ø³ØªÙ…ØªØ¹ ÙˆØ¬Ø±Ù‘Ø¨!&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1">&lt;script&gt;</p>
<p class="p1">(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const els = id =&gt; document.getElementById(id);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const num = el =&gt; parseFloat(el.value);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>let ctx, masterGain, analyser, osc1, osc2, mixGain1, mixGain2, filter, lfo, lfoGain, delay, fb, wet, dry;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>let isDown = false, baseFreq = 220, currentNoteGain, lastGateTime = 0;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>let lfoTarget = 'cutoff';</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const startBtn = els('startBtn');</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const stopAll = els('stopAll');</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const canvas = els('pad');</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const scope = els('scope');</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const presetSel = els('preset');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// Ranges w/ outputs</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>document.querySelectorAll('input[type=range]').forEach(r =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const out = r.nextElementSibling;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const update = () =&gt; out.textContent = r.value;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>r.addEventListener('input', update); update();</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>function init() {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if (ctx) return;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>ctx = new (window.AudioContext || window.webkitAudioContext)();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>// Master / dry-wet</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>masterGain = ctx.createGain(); masterGain.gain.value = num(els('master'));</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>dry = ctx.createGain(); dry.gain.value = 1;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>wet = ctx.createGain(); wet.gain.value = num(els('wet'));</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>// Filter</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>filter = ctx.createBiquadFilter();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>filter.type = els('fType').value;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>filter.frequency.value = num(els('cut'));</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>filter.Q.value = num(els('q'));</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>// Delay line</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>delay = ctx.createDelay(1.0); delay.delayTime.value = num(els('delayTime'));</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>fb = ctx.createGain(); fb.gain.value = num(els('feedback'));</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>delay.connect(fb).connect(delay);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>// Analyser</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>analyser = ctx.createAnalyser();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>analyser.fftSize = 2048;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>// Oscillators + mixer</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>mixGain1 = ctx.createGain(); mixGain2 = ctx.createGain();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>setMix(num(els('mix')));</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>// LFO</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>lfo = ctx.createOscillator(); lfo.type = 'sine';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>lfoGain = ctx.createGain(); lfoGain.gain.value = num(els('lfoDepth')) * 1000; // scaled</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>lfo.frequency.value = num(els('lfoRate'));</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>lfo.connect(lfoGain);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>lfo.start();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>// Routing:</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>// [Oscs] -&gt; Filter -&gt; (dry + delay-&gt;wet) -&gt; Master -&gt; Dest (+ analyser)</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>filter.connect(dry).connect(masterGain);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>filter.connect(delay).connect(wet).connect(masterGain);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>masterGain.connect(analyser).connect(ctx.destination);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>function setMix(v){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if (!mixGain1 || !mixGain2) return;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>mixGain1.gain.value = 1 - v;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>mixGain2.gain.value = v;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>function startOscillators() {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>stopOscillators();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>osc1 = ctx.createOscillator();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>osc2 = ctx.createOscillator();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>osc1.type = els('wave1').value.replace('sinusoid','sine');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>osc2.type = els('wave2').value.replace('sinusoid','sine');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>osc1.detune.value = num(els('detune')) - 5; // slight stereo-ish spread</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>osc2.detune.value = num(els('detune')) + 5;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>osc1.connect(mixGain1).connect(filter);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>osc2.connect(mixGain2).connect(filter);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>// LFO patching</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>lfoGain.disconnect();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>lfoTarget = els('lfoTarget').value;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if (lfoTarget === 'freq') {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>lfoGain.gain.value = num(els('lfoDepth')) * 1200; // cents</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>lfoGain.connect(osc1.detune);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>lfoGain.connect(osc2.detune);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>} else if (lfoTarget === 'cutoff') {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>lfoGain.gain.value = num(els('lfoDepth')) * 4000; // Hz</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>lfoGain.connect(filter.frequency);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>} else { // AM</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>lfoGain.gain.value = num(els('lfoDepth'));</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const amGain = ctx.createGain();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>amGain.gain.value = 1;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>lfoGain.connect(amGain.gain);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>// AM after filter</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>filter.disconnect();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const postFilterGain = ctx.createGain();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>filter.connect(postFilterGain);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>postFilterGain.gain.value = 1;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>lfoGain.connect(postFilterGain.gain);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>// Reconnect to master paths</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>postFilterGain.connect(dry).connect(masterGain);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>postFilterGain.connect(delay).connect(wet).connect(masterGain);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>// Also keep analyser tap</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>masterGain.disconnect(); masterGain.connect(analyser).connect(ctx.destination);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>osc1.start(); osc2.start();</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>function stopOscillators() {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>[osc1, osc2].forEach(o =&gt; { try { if (o) o.stop(); } catch(e){} });</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>osc1 = osc2 = null;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>function gateOn(freq){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if (!ctx) return;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>startOscillators();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const now = ctx.currentTime;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>baseFreq = freq || baseFreq;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>setFrequency(baseFreq);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>// ADSR on a small VCA before filter input</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if (currentNoteGain) { try{ currentNoteGain.disconnect(); }catch(e){} }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>currentNoteGain = ctx.createGain();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>currentNoteGain.gain.cancelScheduledValues(now);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const A = num(els('a')), D = num(els('d')), S = num(els('s'));</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>currentNoteGain.gain.setValueAtTime(0, now);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>currentNoteGain.gain.linearRampToValueAtTime(1, now + A);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>currentNoteGain.gain.linearRampToValueAtTime(S, now + A + D);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>// insert VCA: osc mix -&gt; VCA -&gt; filter</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>mixGain1.disconnect(); mixGain2.disconnect();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>mixGain1.connect(currentNoteGain); mixGain2.connect(currentNoteGain);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>currentNoteGain.connect(filter);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>lastGateTime = now;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>function gateOff(){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if (!ctx || !currentNoteGain) return;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const now = ctx.currentTime;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const R = num(els('r'));</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>currentNoteGain.gain.cancelScheduledValues(now);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>currentNoteGain.gain.setValueAtTime(currentNoteGain.gain.value, now);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>currentNoteGain.gain.linearRampToValueAtTime(0, now + R);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>setTimeout(() =&gt; { try{ currentNoteGain.disconnect(); }catch(e){}; stopOscillators(); }, (R*1000)+20);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>function setFrequency(f){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if (!osc1 || !osc2) return;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>osc1.frequency.setTargetAtTime(f, ctx.currentTime, 0.005);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>osc2.frequency.setTargetAtTime(f, ctx.currentTime, 0.005);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// UI bindings</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>startBtn.addEventListener('click', () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>init();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>ctx.resume();</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>stopAll.addEventListener('click', () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>gateOff();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if (ctx) ctx.suspend();</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// Controls</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>els('master').addEventListener('input', e =&gt; masterGain &amp;&amp; (masterGain.gain.value = num(e.target)));</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>els('mix').addEventListener('input', e =&gt; setMix(num(e.target)));</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>els('detune').addEventListener('input', e =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if (osc1 &amp;&amp; osc2){ osc1.detune.value = num(e.target)-5; osc2.detune.value = num(e.target)+5; }</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>['wave1','wave2','lfoTarget'].forEach(id=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>els(id).addEventListener('change', () =&gt; { if (ctx) startOscillators(); });</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// Filter controls</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>els('fType').addEventListener('change', e =&gt; filter &amp;&amp; (filter.type = e.target.value));</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>els('cut').addEventListener('input', e =&gt; filter &amp;&amp; (filter.frequency.setTargetAtTime(num(e.target), ctx.currentTime, 0.01)));</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>els('q').addEventListener('input', e =&gt; filter &amp;&amp; (filter.Q.value = num(e.target)));</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// LFO &amp; Delay</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>els('lfoRate').addEventListener('input', e =&gt; lfo &amp;&amp; (lfo.frequency.value = num(e.target)));</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>els('lfoDepth').addEventListener('input', e =&gt; lfoGain &amp;&amp; (lfoGain.gain.value = lfoTarget==='freq'? num(e.target)*1200 : lfoTarget==='cutoff'? num(e.target)*4000 : num(e.target)));</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>els('delayTime').addEventListener('input', e =&gt; delay &amp;&amp; (delay.delayTime.setTargetAtTime(num(e.target), ctx.currentTime, 0.02)));</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>els('feedback').addEventListener('input', e =&gt; fb &amp;&amp; (fb.gain.value = num(e.target)));</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>els('wet').addEventListener('input', e =&gt; wet &amp;&amp; (wet.gain.value = num(e.target)));</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// Mouse/touch pad mapping: X -&gt; pitch (log), Y -&gt; cutoff</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>function posToFreq(x, w){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const min=60, max=4000;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const t = Math.max(0, Math.min(1, x / Math.max(1,w)));</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>return min * Math.pow(max/min, t);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>function posToCutoff(y, h){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const min=80, max=12000;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const t = 1 - Math.max(0, Math.min(1, y / Math.max(1,h)));</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>return min * Math.pow(max/min, t);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>function updatePad(e){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const rect = canvas.getBoundingClientRect();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const x = (e.touches? e.touches[0].clientX : e.clientX) - rect.left;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const y = (e.touches? e.touches[0].clientY : e.clientY) - rect.top;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const f = posToFreq(x, rect.width);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const cut = posToCutoff(y, rect.height);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if (ctx &amp;&amp; ctx.state === 'suspended') ctx.resume();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>baseFreq = f;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if (filter) filter.frequency.setTargetAtTime(cut, ctx.currentTime, 0.01);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if (isDown) setFrequency(f);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>drawPad(x,y);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>function wheelDetune(e){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const d = els('detune');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>let v = parseFloat(d.value) + (e.deltaY &lt; 0 ? 10 : -10);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>v = Math.max(parseFloat(d.min), Math.min(parseFloat(d.max), v));</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>d.value = v; d.dispatchEvent(new Event('input'));</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>canvas.addEventListener('mousedown', e =&gt; { isDown = true; updatePad(e); gateOn(baseFreq); });</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>canvas.addEventListener('mousemove', e =&gt; updatePad(e));</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>canvas.addEventListener('mouseup', <span class="Apple-converted-space">Â  </span>e =&gt; { isDown = false; gateOff(); });</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>canvas.addEventListener('mouseleave',e =&gt; { isDown = false; gateOff(); });</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>canvas.addEventListener('wheel', e =&gt; { e.preventDefault(); wheelDetune(e); }, {passive:false});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>canvas.addEventListener('touchstart', e =&gt; { isDown = true; updatePad(e); gateOn(baseFreq); }, {passive:true});</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>canvas.addEventListener('touchmove',<span class="Apple-converted-space">Â  </span>e =&gt; updatePad(e), {passive:true});</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>canvas.addEventListener('touchend', <span class="Apple-converted-space">Â  </span>e =&gt; { isDown = false; gateOff(); }, {passive:true});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// Presets</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>function loadPreset(name){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const set = (id,val) =&gt; { const el=els(id); el.value=val; el.dispatchEvent(new Event('input')); };</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if (name==='pluck'){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>els('wave1').value='triangle'; els('wave2').value='square';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>set('mix',0.35); set('a',0.005); set('d',0.12); set('s',0.35); set('r',0.08);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>els('fType').value='lowpass'; set('cut',1800); set('q',6);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>els('lfoTarget').value='cutoff'; set('lfoRate',6); set('lfoDepth',0.35);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>set('delayTime',0.22); set('feedback',0.42); set('wet',0.28);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>} else if (name==='bass'){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>els('wave1').value='square'; els('wave2').value='square';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>set('mix',0.5); set('a',0.003); set('d',0.1); set('s',0.6); set('r',0.12);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>els('fType').value='lowpass'; set('cut',500); set('q',8);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>els('lfoTarget').value='cutoff'; set('lfoRate',2); set('lfoDepth',0.2);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>set('delayTime',0.1); set('feedback',0.2); set('wet',0.1);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>} else if (name==='pad'){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>els('wave1').value='triangle'; els('wave2').value='sawtooth';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>set('mix',0.6); set('a',0.8); set('d',0.8); set('s',0.8); set('r',1.5);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>els('fType').value='lowpass'; set('cut',2000); set('q',0.9);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>els('lfoTarget').value='am'; set('lfoRate',0.5); set('lfoDepth',0.6);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>set('delayTime',0.35); set('feedback',0.5); set('wet',0.35);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>} else if (name==='lead'){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>els('wave1').value='sawtooth'; els('wave2').value='square';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>set('mix',0.55); set('a',0.01); set('d',0.2); set('s',0.7); set('r',0.25);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>els('fType').value='bandpass'; set('cut',1600); set('q',10);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>els('lfoTarget').value='freq'; set('lfoRate',7); set('lfoDepth',0.25);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>set('delayTime',0.18); set('feedback',0.35); set('wet',0.3);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>} else { // init</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>els('wave1').value='square'; els('wave2').value='sawtooth';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>set('mix',0.5); set('a',0.01); set('d',0.15); set('s',0.6); set('r',0.2);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>els('fType').value='lowpass'; set('cut',1500); set('q',1.0);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>els('lfoTarget').value='cutoff'; set('lfoRate',4); set('lfoDepth',0.5);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>set('delayTime',0.18); set('feedback',0.35); set('wet',0.25);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>set('master',0.3); set('detune',0);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if (ctx) startOscillators();</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>presetSel.addEventListener('change', e =&gt; loadPreset(e.target.value));</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>window.addEventListener('keydown', e =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if (e.code==='Space'){ e.preventDefault(); if (isDown){ isDown=false; gateOff(); } else { isDown=true; gateOn(baseFreq);} }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if (e.key==='1') { presetSel.value='init'; loadPreset('init'); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if (e.key==='2') { presetSel.value='pluck'; loadPreset('pluck'); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if (e.key==='3') { presetSel.value='bass'; loadPreset('bass'); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if (e.key==='4') { presetSel.value='pad'; loadPreset('pad'); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if (e.key==='5') { presetSel.value='lead'; loadPreset('lead'); }</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// Visuals</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>function drawPad(x, y){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const ctx2 = canvas.getContext('2d');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const w = canvas.width = canvas.clientWidth;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const h = canvas.height = canvas.clientHeight;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>ctx2.clearRect(0,0,w,h);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const grad = ctx2.createLinearGradient(0,0,w,h);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>grad.addColorStop(0,'#0b1f38'); grad.addColorStop(1,'#0a0e16');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>ctx2.fillStyle = grad; ctx2.fillRect(0,0,w,h);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if (typeof x==='number' &amp;&amp; typeof y==='number'){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>ctx2.strokeStyle = '#00d0ff';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>ctx2.lineWidth = 1;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>ctx2.beginPath(); ctx2.moveTo(x,0); ctx2.lineTo(x,h); ctx2.moveTo(0,y); ctx2.lineTo(w,y); ctx2.stroke();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>ctx2.fillStyle = '#00d0ff'; ctx2.beginPath(); ctx2.arc(x,y,6,0,Math.PI*2); ctx2.fill();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>// axes labels</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>ctx2.fillStyle = '#9aa4ad'; ctx2.font = '12px system-ui';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>ctx2.fillText('Pitch â†’', 10, 18);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>ctx2.fillText('Cutoff â†“', 10, 34);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>function renderScope(){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const w = scope.width = scope.clientWidth;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const h = scope.height = scope.clientHeight;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const g = scope.getContext('2d');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>g.fillStyle = '#060a12'; g.fillRect(0,0,w,h);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if (!analyser) return requestAnimationFrame(renderScope);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const data = new Uint8Array(analyser.fftSize);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>analyser.getByteTimeDomainData(data);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>g.strokeStyle = '#8fe1ff'; g.lineWidth = 1.2; g.beginPath();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>for (let i=0;i&lt;data.length;i++){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const x = i/data.length * w;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const y = (data[i]/255) * h;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if (i===0) g.moveTo(x,y); else g.lineTo(x,y);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>g.stroke();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>requestAnimationFrame(renderScope);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>drawPad(); renderScope();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// Reflect UI -&gt; nodes in real-time</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>['master','mix','detune','cut','q','lfoRate','lfoDepth','delayTime','feedback','wet'].forEach(id=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>els(id).addEventListener('input', ()=&gt;{}); // already handled above; keeps outputs in sync</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// Keep filter &amp; delay synced when changing type after init</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>els('fType').addEventListener('change', ()=&gt; filter &amp;&amp; (filter.type = els('fType').value));</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// Boot with INIT preset defaults applied to UI</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>loadPreset('init');</p>
<p class="p2"><br></p>
<p class="p1">})();</p>
<p class="p1">&lt;/script&gt;</p>
<p class="p1">&lt;/body&gt;</p>
<p class="p1">&lt;/html&gt;</p>
</body>
</html>
